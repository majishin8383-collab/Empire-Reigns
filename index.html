<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Empire Reigns</title>

  <link rel="stylesheet" href="./styles.css?v=ER-20260109d2c" />
  <style>
    body{margin:0}
    .jsbar{
      position:fixed; left:12px; right:12px; top:12px; z-index:9999;
      padding:10px 12px; border-radius:16px;
      border:1px solid rgba(255,245,220,.18);
      background:rgba(12,10,14,.72);
      color:rgba(255,245,220,.92);
      font: 850 12px system-ui, -apple-system, Segoe UI, Roboto, Arial;
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight:950;}
    .ok{color: rgba(120,220,180,.95);}
    .bad{color: rgba(255,140,170,.95);}
    .warn{color: rgba(255,210,120,.95);}
    .jsbar button{
      border-radius:14px; padding:8px 10px; cursor:pointer;
      border:1px solid rgba(255,245,220,.18);
      background:rgba(255,245,220,.06);
      color:rgba(255,245,220,.92);
      font-weight:900;
    }
  </style>
</head>

<body>
  <div class="jsbar" id="jsbar">
    <div>
      <span class="mono">JS:</span>
      <span id="jsStatus" class="mono">starting…</span>
      <span id="jsDetail" class="mono" style="opacity:.8;margin-left:10px;"></span>
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
      <span class="mono" id="jsBuild">ER-20260109d2c</span>
      <button id="jsReload">Reload (cache-bust)</button>
    </div>
  </div>

  <div class="world" id="worldRoot">

    <div class="hud">
      <div class="hudInner">
        <div class="brand">
          <h1>Empire Reigns</h1>
          <div class="sub"><span id="status">Loading…</span> · <span class="mono" id="sceneNote">starting out</span></div>
        </div>

        <div class="hudStats">
          <div class="pillHud">
            <div class="k">Cash</div>
            <div class="v mono" id="hudCash">$0.00</div>
          </div>
          <div class="pillHud">
            <div class="k">Income</div>
            <div class="v mono" id="hudIps">$0.00/s</div>
          </div>
          <div class="pillHud">
            <div class="k">Streak</div>
            <div class="v mono" id="hudStreak">x1.00</div>
          </div>
          <div class="pillHud">
            <div class="k">EP</div>
            <div class="v mono" id="hudEp">0</div>
          </div>
        </div>
      </div>
    </div>

    <div class="scene" aria-hidden="true">
      <div class="vignette"></div>
      <div class="grain"></div>
      <div class="groundBand"></div>
      <div class="road"></div>
    </div>

    <div class="sign">
      EMPIRE REIGNS <span class="mono" id="verPill">ER-20260109d2</span>
    </div>

    <div class="buildings" aria-label="Buildings">
      <div id="bOffice" class="building b-office" tabindex="0" role="button" aria-label="Office"></div>
      <div id="bWarehouse" class="building b-warehouse" tabindex="0" role="button" aria-label="Warehouse"></div>
      <div id="bGarage" class="building b-garage" tabindex="0" role="button" aria-label="Workshop"></div>
      <div id="bShop" class="building b-shop" tabindex="0" role="button" aria-label="Market"></div>
    </div>

    <div class="people" id="peopleRow" aria-hidden="true"></div>

    <div class="wrap">
      <div class="panel">
        <div class="tabs">
          <button class="tabBtn active" id="tabWorld">World</button>
          <button class="tabBtn" id="tabUpgrades">Upgrades</button>
          <button class="tabBtn" id="tabMilestones">Milestones</button>
          <button class="tabBtn" id="tabPrestige">Prestige</button>
          <span style="flex:1"></span>
          <span class="pill mono" id="luckPill" style="display:none;">✨ Luck is hot</span>
        </div>

        <div class="panelInner">
          <div id="screenWorld">
            <div class="item">
              <div class="itemTop">
                <div>
                  <div class="h">Do Work</div>
                  <div class="small">Tap for cash. Build streak for better taps.</div>
                </div>
                <div class="pill mono" id="streakPill">Streak: x1.00 (0)</div>
              </div>
              <div class="hr"></div>
              <div class="btnRow">
                <button class="primary" id="workBtn">Do Work (+$1.00)</button>
                <button id="quickHireBtn">Quick Hire</button>
                <button id="sfxToggleBtn" class="gold">SFX: ON</button>
                <button id="saveBtn">Save</button>
              </div>
              <div class="small" style="margin-top:10px;opacity:.88;">
                <span class="pill mono" id="ownedPill">Owned: 0</span>
                <span class="pill mono" id="epPill">EP: 0</span>
                <span class="pill mono" id="bLvlSummary">Office 1 · Warehouse 1 · Workshop 1 · Market 1</span>
              </div>
            </div>
          </div>

          <div id="screenUpgrades" style="display:none;">
            <div class="grid">
              <div class="item" id="rowAssistant">
                <div class="itemTop">
                  <div>
                    <div class="h">Assistants</div>
                    <div class="small">Base income engine.</div>
                  </div>
                  <div class="pill mono">Cost: <span id="assistantCost">$0.00</span></div>
                </div>
                <div class="hr"></div>
                <div class="btnRow">
                  <button class="primary" id="buyAssistantBtn">Open</button>
                </div>
              </div>

              <div class="item" id="rowTools">
                <div class="itemTop">
                  <div>
                    <div class="h">Tools</div>
                    <div class="small" id="toolsLockNote">Unlocks after: 1 assistant</div>
                  </div>
                  <div class="pill mono">Cost: <span id="toolsCost">$0.00</span></div>
                </div>
                <div class="hr"></div>
                <div class="btnRow">
                  <button id="buyToolsBtn">Open</button>
                </div>
              </div>

              <div class="item" id="rowProc">
                <div class="itemTop">
                  <div>
                    <div class="h">Processes</div>
                    <div class="small" id="procLockNote">Unlocks after: 1 tools</div>
                  </div>
                  <div class="pill mono">Cost: <span id="procCost">$0.00</span></div>
                </div>
                <div class="hr"></div>
                <div class="btnRow">
                  <button id="buyProcBtn">Open</button>
                </div>
              </div>

              <div class="item" id="rowAuto">
                <div class="itemTop">
                  <div>
                    <div class="h">Automation</div>
                    <div class="small" id="autoLockNote">Unlocks after: 1 process</div>
                  </div>
                  <div class="pill mono">Cost: <span id="autoCost">$0.00</span></div>
                </div>
                <div class="hr"></div>
                <div class="btnRow">
                  <button id="buyAutoBtn">Open</button>
                </div>
              </div>
            </div>

            <div class="item" style="margin-top:12px;">
              <div class="itemTop">
                <div>
                  <div class="h">Multipliers</div>
                  <div class="small mono" id="multDetails">—</div>
                </div>
                <div class="pill mono" id="multSummary">x1.00 total</div>
              </div>
              <div class="hr"></div>
              <div class="small mono">Lifetime earned: <span id="lifetime">$0.00</span></div>
              <div class="small mono" id="statsLine" style="margin-top:6px;">—</div>
            </div>
          </div>

          <div id="screenMilestones" style="display:none;">
            <div class="item">
              <div class="itemTop">
                <div>
                  <div class="h">Milestones</div>
                  <div class="small" id="msNote">Loading…</div>
                </div>
                <div class="pill mono" id="msBonusPill">Bonus x1.00</div>
              </div>
              <div class="hr"></div>
              <div id="msList"></div>
            </div>
          </div>

          <div id="screenPrestige" style="display:none;">
            <div class="item">
              <div class="itemTop">
                <div>
                  <div class="h">Prestige</div>
                  <div class="small" id="prestHint">—</div>
                </div>
                <div class="pill mono" id="prestReq">$10.00K goal</div>
              </div>
              <div class="hr"></div>
              <div class="btnRow">
                <button class="gold" id="prestigeBtn">Prestige (Locked)</button>
                <button class="danger" id="resetBtn">Hard Reset</button>
                <button id="newRunBtn">New Run (keep EP)</button>
              </div>
              <div class="small mono" style="margin-top:10px;">
                Lifetime earned: <span id="lifetime2">$0.00</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="backdropClickCatcher" id="bubbleCatcher"></div>
    <div class="bubble" id="bubble" role="dialog" aria-modal="true">
      <div class="bubbleHeader">
        <div>
          <div class="h" id="bubbleTitle">Title</div>
          <div class="small" id="bubbleSubtitle">Subtitle</div>
        </div>
        <button class="bubbleClose" id="bubbleClose">Close</button>
      </div>
      <div class="bubbleBody">
        <div class="small" id="bubbleDesc">Desc</div>
        <div class="hr"></div>

        <div class="bubbleRow">
          <div class="pill mono" id="bubbleOwned">Owned: 0</div>
          <div class="pill mono" id="bubbleCost">Cost: $0.00</div>
        </div>

        <div class="btnRow" style="margin-top:10px;">
          <button class="primary" id="bubbleBuyBtn">Buy</button>
        </div>

        <div class="small" style="margin-top:10px;opacity:.86;" id="bubbleLockNote">—</div>

        <div class="hr"></div>

        <div class="bubbleRow">
          <div class="pill mono" id="bubbleLevel">Building LV 1</div>
          <div class="pill mono" id="bubbleLevelIncome">+ $0.00/s</div>
        </div>
        <div class="bubbleRow" style="margin-top:8px;">
          <div class="pill mono" id="bubbleLevelCost">Cost: $0.00</div>
          <button class="gold" id="bubbleLevelBtn">Upgrade Building</button>
        </div>
      </div>
    </div>

    <div class="bottomNav">
      <div class="bottomInner">
        <button class="navBtn active" id="navWorld">World<div class="k">Tap + hotspots</div></button>
        <button class="navBtn" id="navUp">Upgrades<div class="k">Buy + scale</div></button>
        <button class="navBtn" id="navMs">Milestones<div class="k">Permanent boosts</div></button>
        <button class="navBtn" id="navPr">Prestige<div class="k">Reset for EP</div></button>
      </div>
    </div>

  </div>

 <script src="./milestones.js?v=ER-20260109d2" defer></script>
<script src="./game.js?v=ER-20260109d2" defer></script>

    (function(){
      const BUILD = "ER-20260109d2c";
      const st = document.getElementById("jsStatus");
      const dt = document.getElementById("jsDetail");
      const bar = document.getElementById("jsbar");
      document.getElementById("jsReload").addEventListener("click", () => {
        location.href = location.pathname + "?v=" + BUILD + "&r=" + Date.now();
      });

      function set(msg, cls){
        st.className = "mono " + (cls||"");
        st.textContent = msg;
      }
      function detail(msg){ dt.textContent = msg || ""; }
      function ok(msg){ set(msg, "ok"); bar.style.borderColor="rgba(120,220,180,.35)"; }
      function bad(msg){ set(msg, "bad"); bar.style.borderColor="rgba(255,140,170,.45)"; }
      function warn(msg){ set(msg, "warn"); bar.style.borderColor="rgba(255,210,120,.45)"; }

      function loadScript(src){
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = src;
          s.async = false;
          s.onload = () => resolve();
          s.onerror = () => reject(new Error("FAILED: " + src));
          document.body.appendChild(s);
        });
      }

      window.addEventListener("error", (e) => bad("Runtime error: " + (e.message || "unknown")));
      window.addEventListener("unhandledrejection", (e) => bad("Promise rejection: " + String(e.reason || "unknown")));

      ok("loading…");
      const q = "?v=" + BUILD + "&t=" + Date.now();

      Promise.resolve()
        .then(() => loadScript("./milestones.js" + q).catch(() => warn("milestones.js missing (ok for now)")))
        .then(() => loadScript("./game.js" + q))
        .then(() => {
          // ---- SELF TESTS ----
          const build = window.BUILD;
          if (!build) {
            bad("game.js loaded but BUILD not set");
            detail("Meaning: your game.js file is not the one we wrote, or it didn't execute.");
            return;
          }

          const workBtn = document.getElementById("workBtn");
          const cashEl = document.getElementById("hudCash");
          if (!workBtn || !cashEl){
            bad("DOM missing #workBtn or #hudCash");
            return;
          }

          // Test 1: does the tick loop change HUD at all?
          const beforeCashText = cashEl.textContent;

          // Test 2: does clicking work change cash text?
          workBtn.click();

          setTimeout(() => {
            const afterClickText = cashEl.textContent;

            if (afterClickText !== beforeCashText) {
              ok("RUNNING ✅ (click worked)");
              detail("BUILD=" + build);
              return;
            }

            // If click didn’t change, wait briefly to see if tick loop updates anything
            setTimeout(() => {
              const laterCashText = cashEl.textContent;

              if (laterCashText !== beforeCashText) {
                ok("RUNNING ✅ (tick loop updating HUD)");
                detail("BUILD=" + build + " · click might be blocked by overlay/pointer-events");
                return;
              }

              bad("DEAD ❌ (no click + no tick updates)");
              detail("BUILD=" + build + " exists, so script executed, but game didn't bind or boot.");
            }, 400);

          }, 120);
        })
        .catch(err => bad(err.message));
    })();
  </script>
</body>
</html>
