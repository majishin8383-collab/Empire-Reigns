/* Empire Reigns — Styles
   Build: ER-20260109d
   Upgrade D: Hotspots + idle animations + cozy polish
*/

:root{
  --bg0:#07080c;
  --bg1:#0b101b;
  --ink:rgba(255,245,220,.92);
  --muted:rgba(255,245,220,.70);
  --dim:rgba(255,245,220,.50);

  --line:rgba(255,245,220,.14);
  --glass:rgba(12,10,14,.58);
  --glass2:rgba(12,10,14,.40);

  --gold:rgba(255,210,120,.85);
  --gold2:rgba(255,210,120,.22);
  --blue:rgba(120,180,255,.80);
  --blue2:rgba(120,180,255,.18);
  --rose:rgba(255,140,170,.75);
  --mint:rgba(120,220,180,.80);

  --shadow:0 30px 90px rgba(0,0,0,.65);
  --shadow2:0 18px 60px rgba(0,0,0,.55);

  --r:18px;
  --r2:22px;

  --tap: cubic-bezier(.2,.8,.2,1);
  --font: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg0);
  color:var(--ink);
  font-family:var(--font);
  overflow-x:hidden;
}

/* -----------------------------------
   World stage
----------------------------------- */
.world{
  position:relative;
  min-height:100vh;
  background:linear-gradient(180deg,var(--bg1),var(--bg0));
  overflow:hidden;
}

.scene{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  opacity:1;
  transform:scale(1.02);
  filter:saturate(1.04) contrast(1.02);
  animation: sceneDrift 18s ease-in-out infinite;
}
@keyframes sceneDrift{
  0%,100%{ transform:scale(1.02) translateY(0px); }
  50%{ transform:scale(1.03) translateY(-6px); }
}

.groundBand{
  position:absolute;
  left:-10%;
  right:-10%;
  bottom:0;
  height:210px;
  background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.24), rgba(0,0,0,.48));
  pointer-events:none;
}

.road{
  position:absolute;
  left:-10%;
  right:-10%;
  bottom:120px;
  height:70px;
  background:linear-gradient(180deg, rgba(255,245,220,.06), rgba(255,245,220,.02));
  border-top:1px solid rgba(255,245,220,.10);
  border-bottom:1px solid rgba(0,0,0,.35);
  transform:skewX(-6deg);
  filter: blur(.2px);
  opacity:.75;
  pointer-events:none;
}
.road:after{
  content:"";
  position:absolute;
  left:0; right:0;
  top:50%;
  height:2px;
  background:linear-gradient(90deg, rgba(255,210,120,0), rgba(255,210,120,.22), rgba(255,210,120,0));
  opacity:.55;
}

/* -----------------------------------
   Sign
----------------------------------- */
.sign{
  position:absolute;
  left:20px;
  top:78px;
  z-index:15;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid rgba(255,245,220,.18);
  background:rgba(12,10,14,.40);
  box-shadow:0 0 0 1px rgba(255,210,120,.10), var(--shadow2);
  backdrop-filter: blur(10px);
  font-weight:1000;
  letter-spacing:.5px;
  text-transform:uppercase;
  display:flex;
  gap:10px;
  align-items:baseline;
}
.sign span{
  font-size:12px;
  letter-spacing:.2px;
  text-transform:none;
  font-weight:900;
  opacity:.75;
}

/* -----------------------------------
   Buildings + hotspots
----------------------------------- */
.buildings{
  position:absolute;
  left:0; right:0;
  bottom:148px;
  height:260px;
  z-index:12;
  pointer-events:auto;
}

.building{
  position:absolute;
  width:230px;
  height:200px;
  transform-origin:center bottom;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  filter: drop-shadow(0 30px 50px rgba(0,0,0,.50));
  transition: transform 140ms var(--tap), filter 200ms var(--tap);
  outline:none;
}

/* positions (tuned for the scene) */
.b-office{ left:7%;  bottom:6px;  }
.b-warehouse{ left:28%; bottom:10px; }
.b-garage{ left:54%; bottom:8px; }
.b-shop{ left:76%; bottom:12px; }

/* idle “alive” animation */
.building{
  animation: buildingBreathe 4.6s ease-in-out infinite;
}
.b-warehouse{ animation-duration: 5.2s; }
.b-garage{ animation-duration: 4.9s; }
.b-shop{ animation-duration: 5.6s; }

@keyframes buildingBreathe{
  0%,100%{ transform: translateY(0px) scale(1); }
  50%{ transform: translateY(-3px) scale(1.01); }
}

/* hotspot glow */
.building::before{
  content:"";
  position:absolute;
  inset:-18px;
  border-radius:26px;
  background: radial-gradient(closest-side, rgba(255,210,120,.18), rgba(120,180,255,.10), rgba(255,245,220,0));
  opacity:.0;
  transition: opacity 180ms var(--tap), transform 180ms var(--tap);
  transform: scale(.98);
  pointer-events:none;
}
.building:hover::before,
.building:focus-visible::before{
  opacity:.85;
  transform: scale(1.02);
}

/* “tap ripple” hotspot */
.building::after{
  content:"";
  position:absolute;
  left:50%;
  top:55%;
  width:10px;
  height:10px;
  border-radius:999px;
  transform: translate(-50%,-50%) scale(1);
  background: radial-gradient(circle, rgba(255,210,120,.35), rgba(120,180,255,.18), rgba(0,0,0,0));
  opacity:0;
  pointer-events:none;
}
.building:active{
  transform: translateY(-2px) scale(1.02);
  filter: drop-shadow(0 40px 60px rgba(0,0,0,.55));
}
.building:active::after{
  animation: ripple 420ms var(--tap) 1;
}
@keyframes ripple{
  0%{ opacity:.0; transform: translate(-50%,-50%) scale(.9); }
  15%{ opacity:.85; }
  100%{ opacity:0; transform: translate(-50%,-50%) scale(12); }
}

/* “canBuy” highlight (from JS) */
.building.canBuy{
  filter: drop-shadow(0 30px 50px rgba(0,0,0,.50)) drop-shadow(0 0 18px rgba(255,210,120,.20));
}
.building.canBuy::before{
  opacity:.95;
  background: radial-gradient(closest-side, rgba(255,210,120,.24), rgba(255,140,170,.10), rgba(0,0,0,0));
}

/* window twinkle overlay (no markup changes) */
.building > svg{
  width:100%;
  height:100%;
}
.building > svg{
  animation: twinkle 3.8s ease-in-out infinite;
}
.b-warehouse > svg{ animation-duration:4.3s; }
.b-garage > svg{ animation-duration:4.1s; }
.b-shop > svg{ animation-duration:4.7s; }

@keyframes twinkle{
  0%,100%{ filter: drop-shadow(0 0 0 rgba(255,210,120,0)); opacity:1; }
  50%{ filter: drop-shadow(0 0 12px rgba(255,210,120,.10)); opacity:.98; }
}

/* smoke puffs (pure CSS) */
.building .smoke, .building .smoke2{ display:none; } /* safety */
.building .smokePuff{ display:none; }

.building::marker{ content:""; } /* noop */

/* smoke via pseudo-elements on specific buildings */
.b-warehouse .smokePuff{ display:none; }
.b-warehouse::before{ /* keep glow */ }

.b-warehouse span{display:none;} /* noop */

.b-warehouse i{display:none;} /* noop */

/* Add smoke with extra pseudo layers without touching markup */
.b-warehouse ._noop{display:none;}

.b-warehouse::after{
  /* preserve ripple on active via :active::after, so we can’t steal ::after permanently */
  /* we’ll use a child-ish effect via box-shadow animation on the svg container */
}
.b-warehouse > svg{
  position:relative;
}
.b-warehouse > svg::after{
  content:"";
  position:absolute;
  left:64%;
  top:20%;
  width:18px;
  height:18px;
  border-radius:999px;
  background:rgba(255,245,220,.12);
  filter: blur(1px);
  opacity:.0;
  animation: smoke 2.8s ease-in-out infinite;
  pointer-events:none;
}
.b-warehouse > svg::before{
  content:"";
  position:absolute;
  left:70%;
  top:18%;
  width:12px;
  height:12px;
  border-radius:999px;
  background:rgba(255,245,220,.10);
  filter: blur(1.2px);
  opacity:.0;
  animation: smoke 2.8s ease-in-out infinite .8s;
  pointer-events:none;
}
@keyframes smoke{
  0%{ transform: translate(0,10px) scale(.6); opacity:0; }
  15%{ opacity:.35; }
  60%{ opacity:.22; }
  100%{ transform: translate(-18px,-28px) scale(1.35); opacity:0; }
}

/* -----------------------------------
   People row (idle walk/bob)
----------------------------------- */
.people{
  position:absolute;
  left:6%;
  right:6%;
  bottom:84px;
  height:48px;
  z-index:13;
  display:flex;
  gap:10px;
  align-items:flex-end;
  justify-content:flex-start;
  pointer-events:none;
}

.person{
  width:16px;
  height:24px;
  border-radius:999px;
  background:linear-gradient(180deg, rgba(255,245,220,.22), rgba(255,245,220,.08));
  border:1px solid rgba(255,245,220,.14);
  box-shadow:0 10px 20px rgba(0,0,0,.25);
  position:relative;
  opacity:.85;
  animation: bob 1.8s ease-in-out infinite, walk 7.5s ease-in-out infinite;
}
.person:before{
  content:"";
  position:absolute;
  left:50%;
  top:-7px;
  width:12px;
  height:12px;
  transform:translateX(-50%);
  border-radius:999px;
  background:rgba(255,210,120,.16);
  border:1px solid rgba(255,210,120,.16);
}
.person:nth-child(2n){ animation-duration: 2.1s, 8.2s; opacity:.78; }
.person:nth-child(3n){ animation-duration: 1.7s, 6.8s; opacity:.82; }
.person:nth-child(5n){ animation-duration: 2.3s, 9.1s; opacity:.74; }

@keyframes bob{
  0%,100%{ transform: translateY(0px); }
  50%{ transform: translateY(-2px); }
}
@keyframes walk{
  0%,100%{ margin-left:0px; }
  50%{ margin-left:10px; }
}

/* -----------------------------------
   HUD (top)
----------------------------------- */
.hud{
  position:sticky;
  top:0;
  z-index:40;
  padding:10px 12px;
  background:linear-gradient(180deg, rgba(7,8,12,.86), rgba(7,8,12,.54), rgba(7,8,12,0));
  backdrop-filter: blur(10px);
}
.hudInner{
  max-width:1160px;
  margin:0 auto;
  display:flex;
  gap:12px;
  align-items:flex-end;
  justify-content:space-between;
}
.brand h1{
  margin:0;
  font-size:18px;
  font-weight:1000;
  letter-spacing:.4px;
}
.brand .sub{
  margin-top:3px;
  font-size:12px;
  opacity:.78;
  font-weight:850;
}
.hudStats{
  display:flex;
  gap:10px;
  align-items:stretch;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.pillHud{
  min-width:120px;
  padding:10px 10px;
  border-radius:16px;
  border:1px solid rgba(255,245,220,.16);
  background:rgba(12,10,14,.46);
  box-shadow:0 0 0 1px rgba(255,210,120,.06);
}
.pillHud .k{
  font-size:10px;
  opacity:.72;
  font-weight:900;
  letter-spacing:.2px;
  text-transform:uppercase;
}
.pillHud .v{
  margin-top:2px;
  font-size:14px;
  font-weight:1000;
}

/* -----------------------------------
   Panel / Tabs / Buttons
----------------------------------- */
.wrap{
  position:relative;
  z-index:30;
  padding:14px 12px 120px;
}
.panel{
  max-width:1160px;
  margin:0 auto;
  border-radius:24px;
  border:1px solid rgba(255,245,220,.14);
  background:rgba(12,10,14,.54);
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  overflow:hidden;
}
.tabs{
  display:flex;
  gap:8px;
  padding:10px;
  border-bottom:1px solid rgba(255,245,220,.12);
  background:rgba(12,10,14,.35);
}
.tabBtn{
  appearance:none;
  border:1px solid rgba(255,245,220,.14);
  background:rgba(255,245,220,.04);
  color:var(--ink);
  font-weight:950;
  padding:10px 12px;
  border-radius:16px;
  cursor:pointer;
  transition: transform 120ms var(--tap), background 120ms var(--tap), border-color 120ms var(--tap);
}
.tabBtn:hover{ background:rgba(255,245,220,.06); }
.tabBtn:active{ transform: translateY(1px); }
.tabBtn.active{
  border-color: rgba(255,210,120,.22);
  background: linear-gradient(180deg, rgba(255,210,120,.10), rgba(120,180,255,.06));
  box-shadow:0 0 0 1px rgba(255,210,120,.10);
}

.panelInner{ padding:12px; }
.grid{
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap:12px;
}
@media (max-width: 980px){
  .grid{ grid-template-columns: 1fr; }
}

.item{
  border-radius:22px;
  border:1px solid rgba(255,245,220,.12);
  background:rgba(255,245,220,.03);
  padding:12px;
  box-shadow:0 0 0 1px rgba(0,0,0,.12);
}
.item.locked{
  opacity:.78;
  border-color: rgba(255,245,220,.10);
}
.item.canBuy{
  border-color: rgba(255,210,120,.18);
  box-shadow:0 0 0 1px rgba(255,210,120,.10), 0 18px 50px rgba(0,0,0,.35);
}

.itemTop{
  display:flex;
  gap:10px;
  align-items:flex-start;
  justify-content:space-between;
}
.h{
  font-size:14px;
  font-weight:1000;
  letter-spacing:.2px;
}
.small{
  font-size:12px;
  opacity:.78;
  line-height:1.35;
}
.hr{
  height:1px;
  background:rgba(255,245,220,.10);
  margin:10px 0;
}

.btnRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

button{
  appearance:none;
  border:1px solid rgba(255,245,220,.14);
  background:rgba(255,245,220,.05);
  color:var(--ink);
  font-weight:950;
  padding:11px 14px;
  border-radius:18px;
  cursor:pointer;
  transition: transform 120ms var(--tap), background 120ms var(--tap), border-color 120ms var(--tap), box-shadow 140ms var(--tap), opacity 120ms var(--tap);
}
button:hover{ background:rgba(255,245,220,.07); }
button:active{ transform: translateY(1px); }
button:disabled{
  opacity:.55;
  cursor:not-allowed;
}
button.primary{
  border-color: rgba(255,210,120,.20);
  background: linear-gradient(180deg, rgba(255,210,120,.12), rgba(120,180,255,.06));
  box-shadow:0 0 0 1px rgba(255,210,120,.08);
}
button.gold{
  border-color: rgba(255,210,120,.25);
  background: linear-gradient(180deg, rgba(255,210,120,.16), rgba(0,0,0,0));
  box-shadow:0 0 0 1px rgba(255,210,120,.12);
}
button.danger{
  border-color: rgba(255,140,170,.22);
  background: linear-gradient(180deg, rgba(255,140,170,.12), rgba(0,0,0,0));
}

.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,245,220,.14);
  background:rgba(12,10,14,.40);
  opacity:.92;
  font-weight:950;
}
.mono{ font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

.sparkle{
  box-shadow: 0 0 0 1px rgba(255,210,120,.10), 0 0 20px rgba(255,210,120,.10);
  border-color: rgba(255,210,120,.22);
}

/* -----------------------------------
   Bubble dialog
----------------------------------- */
.backdropClickCatcher{
  position:fixed;
  inset:0;
  z-index:60;
  background:rgba(0,0,0,.18);
  display:none;
}

.bubble{
  position:fixed;
  z-index:61;
  min-width: 300px;
  max-width: min(420px, calc(100vw - 24px));
  border-radius:24px;
  border:1px solid rgba(255,245,220,.16);
  background:rgba(12,10,14,.68);
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  display:none;
  padding:12px;
}
.bubble:after{
  content:"";
  position:absolute;
  width:16px;
  height:16px;
  left: var(--tailX, 50%);
  bottom:-8px;
  transform: translateX(-50%) rotate(45deg);
  background:rgba(12,10,14,.68);
  border-right:1px solid rgba(255,245,220,.16);
  border-bottom:1px solid rgba(255,245,220,.16);
}

.bubbleHeader{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.bubbleClose{
  padding:9px 12px;
  border-radius:16px;
}
.bubbleBody{ margin-top:10px; }
.bubbleRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

/* -----------------------------------
   Bottom nav
----------------------------------- */
.bottomNav{
  position:fixed;
  left:0; right:0; bottom:0;
  z-index:70;
  padding:10px 12px;
  background:linear-gradient(180deg, rgba(7,8,12,0), rgba(7,8,12,.55), rgba(7,8,12,.86));
  backdrop-filter: blur(10px);
}
.bottomInner{
  max-width:1160px;
  margin:0 auto;
  display:flex;
  gap:10px;
}
.navBtn{
  flex:1;
  padding:10px 10px;
  border-radius:18px;
  text-align:left;
}
.navBtn .k{
  margin-top:3px;
  font-size:11px;
  opacity:.72;
  font-weight:900;
}
.navBtn.active{
  border-color: rgba(255,210,120,.22);
  background: linear-gradient(180deg, rgba(255,210,120,.12), rgba(120,180,255,.06));
  box-shadow:0 0 0 1px rgba(255,210,120,.10);
}

/* -----------------------------------
   Floaters + FX particles
----------------------------------- */
.floater{
  position:fixed;
  z-index:80;
  transform: translate(-50%,-50%);
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,245,220,.14);
  background:rgba(12,10,14,.55);
  box-shadow:0 0 0 1px rgba(255,210,120,.10);
  font-weight:1000;
  font-size:12px;
  pointer-events:none;
  animation: floatUp .65s ease-out 1;
}
@keyframes floatUp{
  from{ opacity:0; transform: translate(-50%,-50%) translateY(10px) scale(.98); }
  20%{ opacity:1; }
  to{ opacity:0; transform: translate(-50%,-50%) translateY(-18px) scale(1.02); }
}

.fxBadge{
  position:fixed;
  z-index:85;
  transform: translate(-50%,-50%);
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(120,180,255,.20);
  background:rgba(12,10,14,.58);
  box-shadow:0 0 0 1px rgba(120,180,255,.10);
  font-weight:1000;
  font-size:12px;
  pointer-events:none;
  animation: badgePop .95s ease-out 1;
}
.fxBadge.gold{
  border-color: rgba(255,210,120,.24);
  box-shadow:0 0 0 1px rgba(255,210,120,.12), 0 0 26px rgba(255,210,120,.10);
}
@keyframes badgePop{
  0%{ opacity:0; transform: translate(-50%,-50%) scale(.92); }
  15%{ opacity:1; transform: translate(-50%,-50%) scale(1.04); }
  100%{ opacity:0; transform: translate(-50%,-50%) translateY(-18px) scale(1.02); }
}

.fxBurst{
  position:fixed;
  z-index:84;
  transform: translate(-50%,-50%);
  pointer-events:none;
}
.fxParticle{
  position:absolute;
  left:0; top:0;
  width:8px; height:8px;
  border-radius:999px;
  background:rgba(255,210,120,.26);
  box-shadow:0 0 10px rgba(255,210,120,.14);
  animation: particle 700ms var(--tap) 1;
}
.fxParticle.blue{
  background:rgba(120,180,255,.22);
  box-shadow:0 0 10px rgba(120,180,255,.12);
}
@keyframes particle{
  0%{ opacity:1; transform: translate(0,0) scale(1); }
  100%{ opacity:0; transform: translate(var(--dx), var(--dy)) scale(.4); }
}

/* -----------------------------------
   Vignette / grain
----------------------------------- */
.vignette{
  position:absolute;
  inset:-40px;
  pointer-events:none;
  z-index:5;
  background: radial-gradient(circle at 50% 30%, rgba(0,0,0,0), rgba(0,0,0,.28) 55%, rgba(0,0,0,.55) 100%);
  opacity:.9;
}
.grain{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:6;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
  opacity:.05;
  mix-blend-mode: overlay;
  animation: grainMove 8s steps(6) infinite;
}
@keyframes grainMove{
  0%,100%{ transform: translate(0,0); }
  50%{ transform: translate(-8px, 6px); }
}

/* -----------------------------------
   Helpers
----------------------------------- */
.padBottom{ height: 10px; }
.msList{ display:block; }
.toggleRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.toggle{ min-width:110px; }
/* Bubble layering fix */
.backdropClickCatcher { z-index: 5000; pointer-events: auto; }
.bubble { z-index: 6000; pointer-events: auto; }
/* Bubble: never cut off on small screens */
.bubble{
  max-height: calc(100vh - 120px);
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
